"use strict"; function _defineProperty(e, t, n) { return t in e ? Object.defineProperty(e, t, { value: n, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = n, e } function _classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } var _slicedToArray = function () { function e(e, t) { var n = [], r = !0, a = !1, o = void 0; try { for (var l, i = e[Symbol.iterator](); !(r = (l = i.next()).done) && (n.push(l.value), !t || n.length !== t); r = !0); } catch (e) { a = !0, o = e } finally { try { !r && i.return && i.return() } finally { if (a) throw o } } return n } return function (t, n) { if (Array.isArray(t)) return t; if (Symbol.iterator in Object(t)) return e(t, n); throw new TypeError("Invalid attempt to destructure non-iterable instance") } }(), _createClass = function () { function e(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } return function (t, n, r) { return n && e(t.prototype, n), r && e(t, r), t } }(); module.exports = function () { function e() { return _classCallCheck(this, e), e.instance === this.getUtils().noop() && (this.CONSTANTS = { ON_LOAD: "onLoad", LIFE_TIMES: "lifetimes", ATTACHED: "attached", LOG: { SOURCE: "来源", DATA: "数据", DATA_LENGTH: "数据长度", COST_TIME: "耗时" } }, this.queueLog = [], this.consoleFlag = !1, this.timer = null, e.instance = this), e.instance } return _createClass(e, [{ key: "run", value: function () { this.consoleFlag = !0; var e = this, t = e.CONSTANTS, n = t.ON_LOAD, r = t.ATTACHED, a = t.LIFE_TIMES, o = e.getUtils(); Page = new Proxy(Page, { apply: function (t, r, a) { var l = _slicedToArray(a, 1), i = l[0]; return i[n] = new Proxy(i[n] || o.createFn(), { apply: function (t, n, r) { return e.setDataProxy(n), Reflect.apply.apply(Reflect, arguments) } }), Reflect.apply.apply(Reflect, arguments) } }), Component = new Proxy(Component, { apply: function (t, n, l) { var i = _slicedToArray(l, 1), c = i[0]; return c.hasOwnProperty(a) && c[a].hasOwnProperty(r) ? c[a][r] = new Proxy(c[a][r] || o.createFn(), { apply: function (t, n, r) { return e.setDataProxy(n), Reflect.apply.apply(Reflect, arguments) } }) : c.hasOwnProperty(r) ? c[r] = new Proxy(c[r] || o.createFn(), { apply: function (t, n, r) { return e.setDataProxy(n), Reflect.apply.apply(Reflect, arguments) } }) : (c[a] = Object.assign(c[a] || {}, _defineProperty({}, r, o.createFn())), c[a][r] = new Proxy(c[a][r] || o.createFn(), { apply: function (t, n, r) { return e.setDataProxy(n), Reflect.apply.apply(Reflect, arguments) } })), Reflect.apply.apply(Reflect, arguments) } }) } }, { key: "stop", value: function () { this.consoleFlag = !1 } }, { key: "setDataProxy", value: function (e) { var t = this, n = t.CONSTANTS.LOG, r = n.SOURCE, a = n.DATA, o = n.DATA_LENGTH, l = n.COST_TIME; e.setData = new Proxy(e.setData, { apply: function (e, n, i) { var c = _slicedToArray(i, 2), u = c[0], p = c[1], s = void 0 === p ? t.getUtils().createFn() : p, y = (new Date).getTime(); return s = new Proxy(s, { apply: function (e, n, i) { var c, p = (new Date).getTime(); return t.queueLog.push((c = {}, _defineProperty(c, r, n.is), _defineProperty(c, a, JSON.stringify(u)), _defineProperty(c, o, JSON.stringify(u).length), _defineProperty(c, l, p - y), c)), t.log(), Reflect.apply.apply(Reflect, arguments) } }), arguments[2][1] = s, Reflect.apply.apply(Reflect, arguments) } }) } }, { key: "log", value: function () { var e = this, t = this.CONSTANTS.LOG.COST_TIME; !this.timer && this.consoleFlag && (this.timer = setTimeout(function () { console.log("setData频率：%c%s", "padding: 2px 4px;background: orange;color: white;border-radius: 2px;", e.queueLog.length + "/s"), console.table(e.queueLog.sort(function (e, n) { e[t], n[t] })), e.queueLog = [], clearTimeout(e.timer), e.timer = null }, 1e3)) } }, { key: "getUtils", value: function () { return { noop: function () { }, createFn: function () { return function () { } } } } }]), e }();